# ============================================
# ResQNet Backend - Environment Configuration
# ============================================
# Copy this file to .env and fill in your actual values
# NEVER commit .env to version control!

# ============================================
# SERVER CONFIGURATION
# ============================================
NODE_ENV=development
PORT=5000
API_VERSION=v1

# ============================================
# DATABASE
# ============================================
# MongoDB Connection String
# Option A: Azure Cosmos DB (MongoDB API)
#   Format: mongodb://ACCOUNT_NAME:KEY@ACCOUNT_NAME.mongo.cosmos.azure.com:10255/resqnet?ssl=true&retrywrites=false
# Option B: MongoDB Atlas
#   Format: mongodb+srv://username:password@cluster.mongodb.net/resqnet?retryWrites=true&w=majority
# Option C: Local MongoDB
#   Format: mongodb://localhost:27017/resqnet

MONGODB_URI=mongodb://localhost:27017/resqnet

# ============================================
# AUTHENTICATION & SECURITY
# ============================================
# Generate a secure random string (64+ characters recommended)
# PowerShell: -join ((48..57) + (65..90) + (97..122) | Get-Random -Count 64 | ForEach-Object {[char]$_})
JWT_SECRET=your_super_secret_jwt_key_change_this_in_production_min_32_chars

# Token expiration times
JWT_EXPIRES_IN=24h
JWT_REFRESH_EXPIRES_IN=7d

# Password hashing rounds (higher = more secure but slower, 12 is recommended)
BCRYPT_ROUNDS=12

# ============================================
# AZURE OPENAI (AI Triage & Emergency Analysis)
# ============================================
# Get these from: Azure Portal > Your OpenAI Resource > Keys and Endpoint
AZURE_OPENAI_ENDPOINT=https://your-instance.openai.azure.com/
AZURE_OPENAI_API_KEY=your_azure_openai_api_key_here
AZURE_OPENAI_DEPLOYMENT_NAME=gpt-4

# API Version (recommended: keep as is)
AZURE_OPENAI_API_VERSION=2024-02-15-preview

# Fallback to rule-based triage if Azure OpenAI unavailable
AI_TRIAGE_FALLBACK_ENABLED=true

# ============================================
# AZURE ENTRA ID (Enterprise Authentication \u0026 RBAC)
# ============================================
# Get these from: Azure Portal \u003e Entra ID \u003e App Registrations
AZURE_ENTRA_ID_ENABLED=false
AZURE_ENTRA_ID_TENANT_ID=your_tenant_id_here
AZURE_ENTRA_ID_CLIENT_ID=your_client_id_here
AZURE_ENTRA_ID_CLIENT_SECRET=your_client_secret_here
AZURE_ENTRA_ID_AUTHORITY=https://login.microsoftonline.com/your_tenant_id

# ============================================
# AZURE AI SPEECH (Voice SOS \u0026 Commands)
# ============================================
# Get these from: Azure Portal \u003e Azure AI Services \u003e Speech
AZURE_SPEECH_ENABLED=false
AZURE_SPEECH_KEY=your_speech_service_key_here
AZURE_SPEECH_REGION=eastus
AZURE_SPEECH_LANGUAGE=en-US

# ============================================
# AZURE AI LANGUAGE (Symptom Extraction)
# ============================================
# Get these from: Azure Portal \u003e Azure AI Services \u003e Language
AZURE_LANGUAGE_ENABLED=false
AZURE_LANGUAGE_KEY=your_language_service_key_here
AZURE_LANGUAGE_ENDPOINT=https://your-language.cognitiveservices.azure.com/

# ============================================
# AZURE EVENT GRID (Real-Time Event Coordination)
# ============================================
# Get these from: Azure Portal \u003e Event Grid Topics
AZURE_EVENT_GRID_ENABLED=false
AZURE_EVENT_GRID_ENDPOINT=https://resqnet-events.eastus-1.eventgrid.azure.net/api/events
AZURE_EVENT_GRID_KEY=your_event_grid_key_here
AZURE_EVENT_GRID_TOPIC_NAME=resqnet-events

# ============================================
# AZURE IOT HUB (Wearable \u0026 Sensor Data)
# ============================================
# Get these from: Azure Portal \u003e IoT Hub
AZURE_IOT_ENABLED=false
AZURE_IOT_CONNECTION_STRING=HostName=resqnet-iot.azure-devices.net;SharedAccessKeyName=iothubowner;SharedAccessKey=your_key

# Vital sign thresholds for auto-emergency trigger
IOT_HEART_RATE_MIN=40
IOT_HEART_RATE_MAX=150
IOT_SPO2_MIN=90
IOT_SYSTOLIC_MAX=180
IOT_TEMPERATURE_MAX=39.5

# ============================================
# AZURE HEALTH DATA SERVICES (FHIR)
# ============================================
# Get these from: Azure Portal \u003e Health Data Services
AZURE_FHIR_ENABLED=false
AZURE_FHIR_URL=https://resqnet-fhir.azurehealthcareapis.com
AZURE_FHIR_TENANT_ID=your_tenant_id_here
AZURE_FHIR_CLIENT_ID=your_fhir_client_id
AZURE_FHIR_CLIENT_SECRET=your_fhir_secret

# ============================================
# AZURE MAPS (Routing, Distance & ETA Calculation)
# ============================================
# Get this from: Azure Portal > Your Maps Account > Authentication > Primary Key
AZURE_MAPS_SUBSCRIPTION_KEY=your_azure_maps_subscription_key_here

# Fallback to Haversine formula if Azure Maps unavailable
MAPS_FALLBACK_ENABLED=true

# ============================================
# AZURE COMMUNICATION SERVICES (SMS Notifications)
# ============================================
# Get these from: Azure Portal > Communication Services > Keys
AZURE_COMMUNICATION_CONNECTION_STRING=endpoint=https://your-service.communication.azure.com/;accesskey=your_key_here

# Phone number for sending SMS (optional, requires purchasing a number)
# Format: E.164 format with country code, e.g., +12345678900
AZURE_COMMUNICATION_PHONE_NUMBER=+1234567890

# Enable/disable SMS notifications (set to false if no phone number)
SMS_NOTIFICATIONS_ENABLED=true

# ============================================
# AZURE WEB PUBSUB (Optional - Alternative to Socket.IO)
# ============================================
AZURE_WEB_PUBSUB_CONNECTION_STRING=Endpoint=https://your-pubsub.webpubsub.azure.com;AccessKey=your_key
AZURE_WEB_PUBSUB_ENABLED=false

# ============================================
# AZURE APPLICATION INSIGHTS (Logging & Monitoring)
# ============================================
# Get these from: Azure Portal > Application Insights > Overview (Essentials section)
AZURE_APPLICATION_INSIGHTS_CONNECTION_STRING=InstrumentationKey=your-key;IngestionEndpoint=https://eastus-8.in.applicationinsights.azure.com/
AZURE_APPLICATION_INSIGHTS_INSTRUMENTATION_KEY=your_instrumentation_key_here

# Enable Application Insights telemetry
APPLICATION_INSIGHTS_ENABLED=true

# ============================================
# CORS & SECURITY
# ============================================
# Allowed origins (comma-separated, no spaces)
# Development: Include your frontend dev server
# Production: Only your production domain
CORS_ORIGIN=http://localhost:3000,http://localhost:5173,http://localhost:4200

# Security Headers
HELMET_ENABLED=true

# ============================================
# RATE LIMITING
# ============================================
# Time window in milliseconds (default: 15 minutes)
RATE_LIMIT_WINDOW_MS=900000

# Max requests per window per IP
RATE_LIMIT_MAX_REQUESTS=100

# Stricter limits for auth endpoints (per IP)
AUTH_RATE_LIMIT_WINDOW_MS=900000
AUTH_RATE_LIMIT_MAX_REQUESTS=5

# ============================================
# LOGGING
# ============================================
# Log levels: error, warn, info, http, verbose, debug, silly
LOG_LEVEL=info

# Log format: json (production) or simple (development)
LOG_FORMAT=simple

# ============================================
# SOCKET.IO (Real-Time Tracking)
# ============================================
SOCKET_IO_ENABLED=true

# CORS origins for Socket.IO (usually same as CORS_ORIGIN)
SOCKET_CORS_ORIGIN=http://localhost:3000,http://localhost:5173

# Socket.IO ping timeout (ms)
SOCKET_PING_TIMEOUT=60000

# ============================================
# GEOSPATIAL SETTINGS
# ============================================
# Default search radius for nearby ambulances/hospitals (in kilometers)
DEFAULT_SEARCH_RADIUS_KM=50

# Maximum number of ambulances to consider for matching
MAX_AMBULANCE_CANDIDATES=10

# Maximum number of hospitals to consider for matching
MAX_HOSPITAL_CANDIDATES=5

# ============================================
# EMERGENCY SETTINGS
# ============================================
# Auto-escalate emergency if not assigned within (minutes)
AUTO_ESCALATION_TIMEOUT_MINUTES=5

# Minimum time between emergency updates (seconds, prevents spam)
EMERGENCY_UPDATE_THROTTLE_SECONDS=30

# ============================================
# DEVELOPMENT/DEBUGGING
# ============================================
# Enable detailed error stack traces (only in development!)
VERBOSE_ERRORS=true

# Mock Azure services for local development without Azure account
MOCK_AZURE_SERVICES=false

# Seed database on startup (only for development!)
AUTO_SEED_DATABASE=false
